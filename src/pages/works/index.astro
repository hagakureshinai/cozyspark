---
// src/pages/works/index.astro
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import WorkCard from "../../components/WorkCard.astro";

const allWorks = await getCollection("works");
const sortedWorks = allWorks.sort((a, b) => a.data.order - b.data.order);

const seriesWorks = sortedWorks.filter(
  (work) => work.data.category === "series",
);
const singleWorks = sortedWorks.filter(
  (work) => work.data.category === "single",
);
const ssWorks = sortedWorks.filter((work) => work.data.category === "ss");

const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, "");

// IDから拡張子を削除するヘルパー関数
const getSlug = (id: string) => id.replace(/\.[^/.]+$/, "");

// ★★★ 【編集エリア】ここから ★★★
// 「初めての方はこちら」に表示したい作品の [ID]（ファイル名）と [見出し] を設定します。
// 例: src/content/works/observer_love.md なら 'observer_love' と書く
const pickupConfig = [
  { id: "observer_cake", label: "＊年下攻×クール受 観測者シリーズ試し読み" },
  { id: "beyond_border", label: "＊おじさま×おじさま" },
  { id: "beyond_control", label: "＊えちえち" },
];
// ★★★ 【編集エリア】ここまで ★★★

// 設定に基づき、作品データと見出しをセットにする
const pickupWorks = pickupConfig
  .map((config) => {
    const work = allWorks.find((w) => getSlug(w.id) === config.id);
    if (!work) return null;
    return { ...work, pickupLabel: config.label }; // 作品データに見出しを合体させる
  })
  .filter((item): item is NonNullable<typeof item> => !!item);
---

<Layout title="Cozy Spark - 作品一覧">
  <header class="page-header">
    <h1>作品一覧</h1>
  </header>

  {/* --- ピックアップ（初めての方はこちら）セクション --- */}
  {
    pickupWorks.length > 0 && (
      <section class="work-category pickup-section">
        <h2>初めての方へ｜おすすめ作品</h2>

        <ul class="work-list">
          {pickupWorks.map((work) => (
            <WorkCard work={work} pickupLabel={work.pickupLabel as string} />
          ))}
        </ul>
      </section>
    )
  }

  {
    seriesWorks.length > 0 && (
      <section class="work-category">
        <div class="category-header-group">
          <h2>観測者シリーズ（長編・連作）</h2>
          <p class="category-info">
            大学生・秋吉悠也(20)×大学教員・藤堂圭(28)のシリーズ。
          </p>
        </div>

        <ul class="work-list">
          {seriesWorks.map((work) => (
            <WorkCard work={work} />
          ))}
        </ul>
      </section>
    )
  }

  {
    singleWorks.length > 0 && (
      <section class="work-category">
        <div class="category-header-group">
          <h2>単発作品</h2>
          <p class="category-info">
            観測者シリーズ以外の、単独で読める作品をまとめています。すべて完結済みです。
          </p>
        </div>

        <ul class="work-list">
          {singleWorks.map((work) => (
            <WorkCard work={work} />
          ))}
        </ul>
      </section>
    )
  }

  {
    ssWorks.length > 0 && (
      <section class="work-category">
        <div class="category-header-group">
          <h2>掌編小説</h2>
          <p class="category-info">
            Xで投稿した150～1000字のSS。すべて完結済みです。
          </p>
        </div>

        <ul class="work-list">
          {ssWorks.map((work) => (
            /* SSはステータスバッジ（完結済など）は不要なら showStatusBadge={false} を渡すことも可。
             とりあえず統一感のためデフォルト(true)で出す。
             ※前の実装ではSSにはバッジ出してなかったが、WorkCard統一で出るようになる。
             もし出したくない場合: showStatusBadge={false}
          */
            <WorkCard work={work} showStatusBadge={false} />
          ))}
        </ul>
      </section>
    )
  }
</Layout>

<style>
  .page-header {
    margin-bottom: 3rem;
  }

  h1 {
    font-size: 1.8rem;
    font-weight: normal;
    border-bottom: 1px solid var(--accent-color);
    padding-bottom: 0.5rem;
    margin-top: 1rem;
  }

  .pickup-section {
    padding: 1.5rem;
    border: 1px solid #e7d1d5;
    border-radius: 8px;
  }

  .work-category {
    margin-bottom: 3rem;
  }

  .category-header-group {
    background-color: #f4f4f4;
    border-left: 4px solid var(--accent-color);
    padding: 0.8rem 1rem;
    margin-bottom: 1.5rem;
    border-radius: 2px;
  }

  h2 {
    font-size: 1.1rem;
    font-weight: bold;
    color: #555;
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    background: none;
    border: none;
    padding: 0;
  }

  .category-info {
    font-size: 0.85rem;
    color: #777;
    margin: 0.3rem 0 0 0;
  }

  .work-list {
    list-style: none;
    padding: 0;
  }
</style>
